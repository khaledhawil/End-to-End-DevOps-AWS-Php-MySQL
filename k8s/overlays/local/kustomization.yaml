apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: tms-app

resources:
  - ../../base
  - mysql-pvc.yaml
  - mysql-deployment.yaml
  - mysql-service.yaml
  - secrets.yaml
  - ingress.yaml

images:
  - name: task-manager:frontend
    newName: localhost:5000/task-manager
    newTag: frontend
  - name: task-manager:users-service
    newName: localhost:5000/task-manager
    newTag: users-service
  - name: task-manager:logout-service
    newName: localhost:5000/task-manager
    newTag: logout-service

# Note: commonLabels removed because it adds labels to NetworkPolicy selectors,
# breaking pod matching. Use patches to add labels to specific resources if needed.

patches:
  - patch: |-
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: frontend
      spec:
        template:
          spec:
            imagePullSecrets: null
    target:
      kind: Deployment
      name: frontend
  - patch: |-
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: users-service
      spec:
        template:
          spec:
            imagePullSecrets: null
    target:
      kind: Deployment
      name: users-service
  - patch: |-
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: logout-service
      spec:
        template:
          spec:
            imagePullSecrets: null
    target:
      kind: Deployment
      name: logout-service
